var promotionsInputViewModel=function(n){function f(n,t){var i=t.charCode||t.keyCode;return i===13?(n(),!1):!0}function o(){$.ajax({type:"GET",url:r+"/defaultqualifyingshippingpromotion",success:function(n){n.DefaultQualifyingShippingPromotionExists&&(t.defaultQualifyingShippingPromotionCode(n.PromotionCode),t.defaultQualifyingShippingPromotionMinimumValueThreshold(n.MinimumOrderValueThreshold),t.defaultQualifyingShippingPromotionThreshold(n.PromotionThreshold))}})}function s(n){var i=t.defaultQualifyingShippingPromotionCode(),r,f,u;return i?(r=t.defaultQualifyingShippingPromotionMinimumValueThreshold(),f=t.defaultQualifyingShippingPromotionThreshold(),r===0)?"We love FREE SHIPPING!<br/>Enter "+i+" above to receive this offer.":n>r?"Congratulations! You qualify for <b>Free Shipping<\/b><br>Enter <b>"+i+"<\/b> above to receive this offer.":(u=(r-n).toFixed(2),u>f)?"We love <b>FREE SHIPPING!<\/b><br>Spend $"+u+" more to receive <b>Free Shipping<\/b><br>Enter <b>"+i+"<\/b> to receive this offer":void 0:""}var t=this,i=n.promotion,e=1,r="api/Promotions",u;t.notify=n.notify;u=!i().ResolvedKeycode&&i().EnteredKeycode;t.PromotionCode=ko.observable("");t.setPromotionCode=ko.computed(function(){if(u){u=!1;return}t.PromotionCode(i().EnteredKeycode?i().EnteredKeycode:"")});t.PromotionCodeIsValid=ko.observable(i().ResolvedKeycode?!0:!1);t.PromotionMessages=ko.observableArray();t.setPromotionMessages=ko.computed(function(){t.PromotionMessages(i().PromotionMessages)});t.defaultQualifyingShippingPromotionCode=ko.observable("");t.defaultQualifyingShippingPromotionMinimumValueThreshold=ko.observable();t.defaultQualifyingShippingPromotionThreshold=ko.observable();t.StatusMessage=ko.observable("");t.ErrorMessage=ko.observable("");t.AppliedMessages=ko.computed(function(){return t.PromotionMessages().filter(function(n){return n.MessageType==="Applied"})});t.UnappliedMessages=ko.computed(function(){return t.PromotionMessages().filter(function(n){return n.MessageType==="Unapplied"})});t.HasAppliedMessages=ko.computed(function(){return t.AppliedMessages().length>0});t.HasUnappliedMessages=ko.computed(function(){return t.UnappliedMessages().length>0});t.ShowUnappliedMessagesTopBorder=ko.computed(function(){return{"promotion-messages--unapplied":t.HasAppliedMessages()}});t.ShippingCountryIsNotInternational=ko.computed(function(){var t=n.shippingCountry();return!t||t==="US"||t==="CA"});t.DefaultQualifyingShippingPromotionMessage=ko.computed(function(){var t=n.taxableItemSubtotal();return s(t)});t.ShowDefaultQualifyingShippingPromotionMessage=ko.computed(function(){return t.DefaultQualifyingShippingPromotionMessage()&&!t.PromotionCodeIsValid()&&t.ShippingCountryIsNotInternational()});t.onKeyPressApplyPromo=function(n,i){return f(t.ApplyPromo,i)};t.onKeyPressRemovePromo=function(n,i){return f(t.RemovePromo,i)};t.RemovePromo=function(){$.ajax({type:"DELETE",url:r,contentType:"application/json;charset=utf-8",success:function(){t.PromotionCode("");t.StatusMessage("");t.ErrorMessage("");t.PromotionCodeIsValid(!1);$(".promotion-code-box__input-label").focus();t.SendPromotionChangedNotification()}})};t.ApplyPromo=function(){var n={PromotionCode:t.PromotionCode()};t.StatusMessage("");t.ErrorMessage("");$.ajax({type:"POST",url:r,data:JSON.stringify(n),contentType:"application/json;charset=utf-8",success:function(n){n&&(n.StatusMessage&&(t.StatusMessage(n.StatusMessage),n.PromotionCodeStatus===e&&t.PromotionCodeIsValid(!0)),n.ErrorMessage&&t.ErrorMessage(n.ErrorMessage),t.SendPromotionChangedNotification())}})};t.SendPromotionChangedNotification=function(){t.notify&&t.notify()};o()}